# Android UI卡顿分析与优化

## 了解渲染刷新机制

VSYNC(垂直刷新/绘制)

60HZ是屏幕刷新理想的频率。60fps---一秒内绘制的帧数。 24帧/秒 电源胶卷时代

在60fps内，系统会得到发送的VSYNC(垂直刷新)信号去进行渲染，就会正常地绘制。 60fps要求：每一帧只能停留16ms.

VSYNC：有两个概念 1）Refresh Rate：屏幕在一秒时间内刷新屏幕的次数----有硬件的参数决定，比如60HZ. 2）Frame Rate：GPU在一秒内绘制操作的帧数，比如：60fps。

GPU刷新：GPU帮助我们将UI组件等计算成纹理Texture和三维图形Polygons，同时会使用OpenGL---会将纹理和Polygons缓存在GPU内存里面。

## 卡顿是如何造成的

卡主线程了！（卡UI线程），说白了就是再主线程中执行了耗时的操作，这又分为两部分：

### 1、外部引起的

比如：

- Activity里面直接进行网络访问/大文件的IO操作

- 内存这一块有些什么要注意的。

  - 1）内存抖动的问题。

    ```
      new Object
      obj = null
    ```

  - 2）一个方法太耗时了。

### 2、View本身的卡顿

自定义View要注意的，能否优化

1）可以使用Allocation Tracing来定位大致的情况 2）可以使用TraceView来确定详细的问题所在。

## 优化

1、渲染性能的优化 2、防止过度绘制